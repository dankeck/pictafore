<style>
  .nitter-frame {
    width: 100%;
    border: none;
    min-height: 100vh;
    outline: none;
  }
  .load-wrap {
    z-index: 51;
    position: relative;
  }
</style>
<script>
    import { store } from '../../_store/store.js'
    import iframeResizer from 'iframe-resizer';
    import DynamicPageBanner from '../../_components/DynamicPageBanner.html'
    import LoadingPage from '../../_components/LoadingPage.html'
    import { importShowMediaDialog } from '../../_components/dialog/asyncDialogs/importShowMediaDialog.js'
    export default {
      computed: {
        url: ({ params }) => "https://pinafore-themed-nitter.easrng.workers.dev/"+params.url,
      },
      store: () => store,
      data: () => ({
        loading: true
      }),
      oncreate() {
        iframeResizer.iframeResize({log:true, initCallback: (...args)=>{
          console.debug("init", args)
          this.refs.frame.iFrameResizer.sendMessage({theme:location.origin+`/theme-${__store.get().currentTheme}.css`})
        }, onMessage: async ({message})=>{
          const {url, unload, } = message;
          if(url) {
            let newURL=`/nitter/${encodeURIComponent(url)}`
            if(newURL != location.pathname) history.pushState({id: 0}, "", newURL)
            this.set({loading: false})
          }
          if(unload) this.set({loading: true})
          if(lightbox) {
            const showMediaDialog = await importShowMediaDialog()
            console.info(showMediaDialog)
          }
        }}, this.refs.frame);
      },
      components: {
        DynamicPageBanner,
        LoadingPage
      }
    }
</script>
<DynamicPageBanner title="" />
{#if loading}
<div class="load-wrap"><LoadingPage /></div>
{/if}
<iframe src={url} class="nitter-frame" ref:frame scrolling="no"></iframe>