<SettingsLayout page='settings/general' label="{'intl.general'}">
  <h1>{'intl.generalSettings'}</h1>

  <h2 id="section-media">{'intl.media'}</h2>
  <form class="ui-settings">
    <label class="setting-group">
      <input type="checkbox" id="choice-never-mark-media-sensitive"
             bind:checked="$neverMarkMediaAsSensitive" on:change="onChange(event)">
      {'intl.showSensitive'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-show-all-spoilers"
             bind:checked="$showAllSpoilers" on:change="onChange(event)">
      {'intl.showAllSpoilers'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-use-blurhash"
              bind:checked="$ignoreBlurhash" on:change="onChange(event)">
      {'intl.showPlain'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-mark-media-sensitive"
             bind:checked="$markMediaAsSensitive" on:change="onChange(event)">
      {'intl.allSensitive'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-autoplay-gif"
             bind:checked="$autoplayGifs" on:change="onChange(event)">
      {'intl.autoplayGifs'}
    </label>
  </form>

  <h2 id="section-ui">{'intl.ui'}</h2>
  <form class="ui-settings">
    <label class="setting-group">
      <input type="checkbox" id="choice-disable-custom-scrollbars"
             bind:checked="$disableCustomScrollbars" on:change="onChange(event)">
      {'intl.disableCustomScrollbars'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-disable-infinite-scroll"
             bind:checked="$disableInfiniteScroll" on:change="onChange(event)">
      {'intl.disableInfiniteScrollPre'}
        <Tooltip
          text="{'intl.disableInfiniteScrollText'}"
          tooltipText="{'intl.disableInfiniteScrollDescription'}"
        />
      {'intl.disableInfiniteScrollPost'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-hide-cards"
             bind:checked="$hideCards" on:change="onChange(event)">
      {'intl.hideCards'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-underline-links"
             bind:checked="$underlineLinks" on:change="onChange(event)">
      {'intl.underlineLinks'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-center-nav"
             bind:checked="$centerNav" on:change="onChange(event)">
      {'intl.centerNav'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-bottom-nav"
             bind:checked="$bottomNav" on:change="onChange(event)">
      {'intl.bottomNav'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-hide-long-posts"
             bind:checked="$hideLongPosts" on:change="onChange(event)">
      {'intl.hideLongPosts'}
    </label>
  </form>

  <h2 id="section-accessibility">{'intl.accessibility'}</h2>
  <form class="ui-settings">
    <label class="setting-group">
      <input type="checkbox" id="choice-reduce-motion"
             bind:checked="$reduceMotion" on:change="onChange(event)">
      {'intl.reduceMotion'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-always-show-focus-ring"
             bind:checked="$alwaysShowFocusRing" on:change="onChange(event)">
      {'intl.showRingPre'}
      <Tooltip
        text="{'intl.showRingText'}"
        tooltipText="{'intl.showRingDescription'}"
      />
      {'intl.showRingPost'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-disable-tap-on-status"
             bind:checked="$disableTapOnStatus" on:change="onChange(event)">
      {'intl.disableTappable'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-omit-emoji-in-display-names"
             bind:checked="$omitEmojiInDisplayNames" on:change="onChange(event)">
      {'intl.removeEmoji'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-disable-long-aria-labels"
             bind:checked="$disableLongAriaLabels" on:change="onChange(event)">
      {'intl.shortAria'}
    </label>
    <label class="setting-group">
      <input type="checkbox" id="choice-grayscale"
             bind:checked="$enableGrayscale" on:change="onChange(event)">
      {'intl.grayscaleMode'}
    </label>
  </form>

  <h2 id="section-wellness">{'intl.wellness'}</h2>

  <form class="ui-settings">
    <p>
      {'intl.wellnessDescription'}
    </p>

    <label class="setting-group">
      <input type="checkbox" id="choice-check-all"
             on:change="onCheckAllChange(event)">
      {'intl.enableAll'}
    </label>
    <h3>{'intl.metrics'}</h3>
      <label class="setting-group">
        <input type="checkbox" id="choice-disable-follower-counts"
               bind:checked="$disableFollowerCounts" on:change="onChange(event)">
        {'intl.hideFollowerCount'}
      </label>
      <label class="setting-group">
        <input type="checkbox" id="choice-disable-reblog-counts"
               bind:checked="$disableReblogCounts" on:change="onChange(event)">
        {'intl.hideReblogCount'}
      </label>
      <label class="setting-group">
        <input type="checkbox" id="choice-disable-fav-counts"
               bind:checked="$disableFavCounts" on:change="onChange(event)">
        {'intl.hideFavoriteCount'}
      </label>

      <h3>{'intl.immediacy'}</h3>
    
        <label class="setting-group">
          <input type="checkbox" id="choice-disable-unread-notification-counts"
                 bind:checked="$disableNotificationBadge" on:change="onChange(event)">
          {'intl.hideUnread'}
        </label>
        <label class="setting-group">
          <input type="checkbox" id="choice-disable-notification-sound"
                 bind:checked="$disableNotificationSound" on:change="onChange(event)">
          {'intl.disableNotificationSound'}
        </label>
        <label class="setting-group">
          <input type="checkbox" id="choice-disable-follow-request-count"
                 bind:checked="$disableFollowRequestCount" on:change="onChange(event)">
          {'intl.disableFollowRequestCount'}
        </label>
        <label class="setting-group">
          <input type="checkbox" id="choice-disable-relative-timestamps"
                 bind:checked="$disableRelativeTimestamps" on:change="onChange(event)">
          {'intl.showAbsoluteTimestamps'}
        </label>
    
      <p>
        {'intl.filterNotificationsPre'}
        <a rel="prefetch" href="/settings/instances{$currentInstance ? '/' + $currentInstance : ''}">{'intl.filterNotificationsText'}</a>.
        {'intl.filterNotificationsPost'}
      </p>
      <p>
        {@html 'intl.wellnessFooter'}
      </p>
  </form>

  {#if $isUserLoggedIn }
    <h2>{themeTitle}</h2>
    <ThemeSettings instanceName={$currentInstance} />
  {/if}
</SettingsLayout>
<UISettingsStyles />
<script>
  import SettingsLayout from '../../_components/settings/SettingsLayout.html'
  import ThemeSettings from '../../_components/settings/instance/ThemeSettings.html'
  import { store } from '../../_store/store.js'
  import Tooltip from '../../_components/Tooltip.html'
  import UISettingsStyles from '../../_components/settings/UISettingsStyles.html'
  import { formatIntl } from '../../_utils/formatIntl.js'

  export default {
    oncreate () {
      this.flushChangesToCheckAll()
    },
    components: {
      SettingsLayout,
      ThemeSettings,
      Tooltip,
      UISettingsStyles
    },
    methods: {

      flushChangesToCheckAll () {
        const {
          disableFollowerCounts,
          disableReblogCounts,
          disableFavCounts,
          disableNotificationBadge,
          disableNotificationSound,
          disableRelativeTimestamps,
          disableFollowRequestCount
        } = this.store.get()
        document.querySelector('#choice-check-all').checked = disableFollowerCounts &&
          disableReblogCounts &&
          disableFavCounts &&
          disableNotificationBadge &&
          disableNotificationSound &&
          disableRelativeTimestamps &&
          disableFollowRequestCount
      },
      onCheckAllChange (e) {
        const { checked } = e.target
        this.store.set({
          disableFollowerCounts: checked,
          disableReblogCounts: checked,
          disableFavCounts: checked,
          disableNotificationBadge: checked,
          disableNotificationSound: checked,
          disableRelativeTimestamps: checked,
          disableFollowRequestCount: checked
        })
        this.store.save()
      },
      onChange (event) {
        this.flushChangesToCheckAll()
        // these two are mutually exclusive
        const { markMediaAsSensitive, neverMarkMediaAsSensitive } = this.store.get()
        if (markMediaAsSensitive && neverMarkMediaAsSensitive) {
          if (event.target.id === 'choice-mark-media-sensitive') {
            this.store.set({ neverMarkMediaAsSensitive: false })
          } else {
            this.store.set({ markMediaAsSensitive: false })
          }
        }
        this.store.save()
      }
    },
    store: () => store,
    computed: {
      themeTitle: ({ $loggedInInstancesInOrder, $currentInstance }) => (
        $loggedInInstancesInOrder.length > 1
          ? formatIntl('intl.themeForInstance', { instance: $currentInstance })
          : 'intl.theme'
      )
    }
  }
</script>
